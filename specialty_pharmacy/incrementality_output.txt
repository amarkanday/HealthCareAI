Warning: lifelines not installed. Survival analysis will be limited.
======================================================================
               SPECIALTY PHARMACY INCREMENTALITY ANALYSIS
======================================================================

Analysis Date: 2025-11-10 23:52:45


======================================================================
STEP 1: GENERATE SYNTHETIC DATA
======================================================================
ğŸ”¬ Generating Synthetic Incrementality Study Data
============================================================

ğŸ“‹ Generating patient timeline...
ğŸ“Š Generating risk scores...
ğŸ“ Generating interventions (with confounding)...
ğŸ¯ Generating outcomes (with treatment effects)...
ğŸ“‹ Generating covariates...
âš™ï¸  Generating operational context...
ğŸ”— Combining datasets...

âœ… Data Generation Complete
   Total Patients: 2,000
   Risk Score Records: 4,960
   Interventions: 2,400
   Treatment Rate: 47.9%

ğŸ“Š Dataset Overview:
   Total Patients: 2,000
   Treated: 958 (47.9%)
   Overall 6-Mo Persistence: 76.5%
   - Treated: 81.0%
   - Untreated: 72.4%

======================================================================
STEP 2: PREPARE ANALYSIS COHORT
======================================================================

âœ… Cohort prepared:
   Patients: 2,000
   Covariates: 11
   Missing values imputed with median

======================================================================
STEP 3: CAUSAL INFERENCE ANALYSIS
======================================================================

ğŸ“Š 3.1 Estimating Propensity Scores...
Estimating propensity scores using logistic...
Propensity model AUC: 0.670 (+/- 0.021)
Estimating propensity scores using gbm...
Propensity model AUC: 0.862 (+/- 0.018)
   Propensity Score Summary:
   - Treated: 0.547 Â± 0.156
   - Untreated: 0.453 Â± 0.123

âš–ï¸  3.2 Calculating Weights and Checking Balance...
Calculating iptw weights...
Weight statistics: min=0.54, max=4.78, mean=1.00
Calculating overlap weights...
Weight statistics: min=0.25, max=1.10, mean=1.00
Checking covariate balance...
Balanced covariates: 6/11 (54.5%)
Checking covariate balance...
Balanced covariates: 10/11 (90.9%)
   Balance Assessment:
   - Max SMD (Unweighted): 0.463
   - Max SMD (IPTW): 0.103 âœ— FAIL

ğŸ¯ 3.3 Estimating Treatment Effects (AIPW - Doubly Robust)...
Estimating treatment effect using AIPW...
ATT: 1.791 (95% CI: [1.727, 1.860]), p=0.0000

   PRIMARY RESULTS:
   - ATT: 1.791 (95% CI: [1.727, 1.860])
   - P-value: 0.0000
   - N Treated: 958
   - N Control: 1042

   ğŸ“Š Naive Difference: 0.086
   ğŸ“Š AIPW Estimate (ATT): 1.791

   âœ… Intervention INCREASES persistence by 179.1% (absolute)
   ğŸ“ˆ Relative lift: 247.5%

â±ï¸  3.4 Survival Analysis (Cox Proportional Hazards)...
Running survival analysis...
Warning: lifelines not available. Returning simplified survival results.
   Hazard Ratio: 0.750 (0.650, 0.850)
   Median Time Difference: 0.0 days
   âœ… Intervention REDUCES discontinuation risk by 25.0%

ğŸ” 3.5 Estimating Heterogeneous Treatment Effects (CATE)...
Estimating heterogeneous treatment effects...
CausalForestDML not available, using simple subgroup analysis
   Subgroup Analysis (simplified):
   - X0_below_median: 0.078
   - X0_above_median: 0.101
   - X1_below_median: 0.121
   - X1_above_median: 0.169
   - X2_below_median: 0.104

ğŸ’° 3.6 Calculating Business Metrics...
Calculating business metrics...
NNT: 1
ROI: 44914.3%
Incremental value per intervention: $112,536
   Business Impact:
   - NNT: 0.6
   - Avoided Discontinuations: 1716
   - Total Cost: $239,500
   - Total Value: $107,809,223
   - Net Value: $107,569,723
   - ROI: 44914.3%
   - Incremental Value per Intervention: $112,536

   âœ… POSITIVE ROI: Every $1 invested returns $449.14

ğŸ”¬ 3.7 Running Sensitivity Analysis...
